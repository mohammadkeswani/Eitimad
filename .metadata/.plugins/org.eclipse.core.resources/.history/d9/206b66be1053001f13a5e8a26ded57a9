package jodayn;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import java.io.FileOutputStream;
import java.io.IOException;
import java.time.Duration;
import java.util.List;
import java.util.NoSuchElementException;
import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.annotations.Test;

public class class2 extends class1 {


    @Test()
    public void SearchForCompetition() throws InterruptedException, IOException {
    
   	 // Create a new workbook and sheet
        Workbook workbook = new XSSFWorkbook();
        Sheet sheet = workbook.createSheet("Competition Data");

        driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(7));
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(30));
        //click on search
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//button[@id='searchBtnColaps']")));
        driver.findElement(By.xpath("//button[@id='searchBtnColaps']")).click();
        // fill searchType
        driver.findElement(By.id("txtMultipleSearch")).sendKeys(SearchType[0]);

        // choose competitionsStatus
        Actions actions = new Actions(driver);

        // click on Search
        WebElement scrollForSearch = driver.findElement(By.id("searchBtn"));
        actions.moveToElement(scrollForSearch).perform();
        //search 
        driver.findElement(By.id("searchBtn")).click();

        // get the data 
        Thread.sleep(2000);
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("div h3 a")));
        List<WebElement> titleList = driver.findElements(By.cssSelector("div h3 a"));
        List<WebElement> mainActivityResult = driver.findElements(By.cssSelector("div[class$='col-12 pt-2']"));
        List<WebElement> Information = driver.findElements(By.cssSelector(".tender-date.border-left"));
        List<WebElement> cost = driver.findElements(By.cssSelector(".tender-coast"));
        
        // Create header row
        Row headerRow = sheet.createRow(0);
        headerRow.createCell(0).setCellValue("Title");
        headerRow.createCell(1).setCellValue("Link href");
        headerRow.createCell(2).setCellValue("Main Activity Result");
        headerRow.createCell(3).setCellValue("Information");
        headerRow.createCell(4).setCellValue("Cost");

        int rowNum = 1;
        for (int i = 0; i < titleList.size(); i++) {
            Row row = sheet.createRow(rowNum++);

            WebElement title = titleList.get(i);

            // Print the text of the <h3> element
            String titleText = title.getText();
            row.createCell(0).setCellValue(titleText);

            // Try to find an <a> element within the current <h3>
            WebElement linkElement = title;
            if (i == titleList.size()) {
                try {
                    linkElement = title.findElement(By.tagName("a"));
                } catch (NoSuchElementException e) {
                    // Handle exception
                }
            }
            // If an <a> element is found, get the href attribute
            String hrefValue = linkElement.getAttribute("href");
            row.createCell(1).setCellValue(hrefValue);

            // print Main Activity Result
            String mainActivityText = mainActivityResult.get(i).getText();
            row.createCell(2).setCellValue(mainActivityText);

            row.createCell(3).setCellValue(Information.get(i).getText());
            row.createCell(4).setCellValue(cost.get(i).getText());
        }

        // Write the output to a file
        try (FileOutputStream fileOut = new FileOutputStream("C:\\details\\console_output.xlsx")) {
            workbook.write(fileOut);
        } finally {
            workbook.close();
        }
    }
}
